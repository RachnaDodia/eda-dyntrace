---
- name: Restore nginx service and update ServiceNow ticket and Dynatrace Problem
  hosts: all
  gather_facts: false
  become: true
  tasks:
    - name: Restart Nginx
      ansible.builtin.debug:
        msg: "Restarting Nginx Webserver!"

    - name: Restart Web Server
      ansible.builtin.service:
        name: nginx
        state: restarted
      register: chksrvc

    - name: Validate, update ITSM and close Dyantrace problem ticke if serice is restored
      block:
        - name: Print chksrvc
          ansible.builtin.debug:
            msg: "Hey your nginix web server is back up. Good for you"
      when: chksrvc.state == "started"
